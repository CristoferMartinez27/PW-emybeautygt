<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firebase</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #252526;
            padding: 20px;
            border-radius: 8px;
        }
        h1 { color: #4ec9b0; }
        .log { 
            background: #1e1e1e;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 3px solid #007acc;
        }
        .success { border-left-color: #4ec9b0; color: #4ec9b0; }
        .error { border-left-color: #f48771; color: #f48771; }
        .warning { border-left-color: #dcdcaa; color: #dcdcaa; }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1177bb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Test de Conexi√≥n Firebase</h1>
        
        <button id="testConnection">1. Probar Conexi√≥n</button>
        <button id="listCollections">2. Listar Colecciones</button>
        <button id="listProducts">3. Listar Productos</button>
        <button id="addTestProduct">4. Agregar Producto de Prueba</button>
        
        <div id="output"></div>
    </div>

    <script type="module">
        import { db } from './js/firebase-config.js';
        import { collection, getDocs, addDoc, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const output = document.getElementById('output');

        function log(message, type = 'log') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = message;
            output.appendChild(div);
            console.log(message);
        }

        function clear() {
            output.innerHTML = '';
        }

        // Test 1: Conexi√≥n b√°sica
        document.getElementById('testConnection').addEventListener('click', async () => {
            clear();
            log('üîç Probando conexi√≥n a Firebase...', 'log');
            
            try {
                if (db) {
                    log('‚úÖ Firestore inicializado correctamente', 'success');
                    log(`üìä App: ${db.app.name}`, 'success');
                } else {
                    log('‚ùå Firestore NO est√° inicializado', 'error');
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        });

        // Test 2: Listar todas las colecciones (simulado)
        document.getElementById('listCollections').addEventListener('click', async () => {
            clear();
            log('üîç Intentando acceder a colecciones comunes...', 'log');
            
            const commonCollections = ['products', 'Products', 'productos', 'items', 'Items'];
            
            for (const collName of commonCollections) {
                try {
                    const collRef = collection(db, collName);
                    const snapshot = await getDocs(collRef);
                    
                    if (snapshot.size > 0) {
                        log(`‚úÖ Colecci√≥n "${collName}" encontrada con ${snapshot.size} documentos`, 'success');
                    } else {
                        log(`‚ö†Ô∏è Colecci√≥n "${collName}" existe pero est√° vac√≠a`, 'warning');
                    }
                } catch (error) {
                    log(`‚ùå "${collName}": ${error.message}`, 'error');
                }
            }
        });

        // Test 3: Listar productos
        document.getElementById('listProducts').addEventListener('click', async () => {
            clear();
            log('üîç Listando productos de la colecci√≥n "products"...', 'log');
            
            try {
                const productsRef = collection(db, 'products');
                const snapshot = await getDocs(productsRef);
                
                log(`üì¶ Total de productos: ${snapshot.size}`, snapshot.size > 0 ? 'success' : 'warning');
                
                if (snapshot.size > 0) {
                    log('<h3>Productos encontrados:</h3>', 'log');
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        log(`<pre>ID: ${doc.id}\n${JSON.stringify(data, null, 2)}</pre>`, 'success');
                    });
                } else {
                    log('‚ö†Ô∏è La colecci√≥n "products" est√° vac√≠a. Usa el bot√≥n 4 para agregar un producto de prueba.', 'warning');
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        });

        // Test 4: Agregar producto de prueba
        document.getElementById('addTestProduct').addEventListener('click', async () => {
            clear();
            log('üîç Agregando producto de prueba...', 'log');
            
            try {
                const testProduct = {
                    name: 'Producto de Prueba',
                    order: 1,
                    category: 'labiales',
                    price: 39.99,
                    image: 'https://via.placeholder.com/300x300?text=Producto+Prueba',
                    description: 'Este es un producto de prueba creado autom√°ticamente'
                };
                
                const docRef = await addDoc(collection(db, 'products'), testProduct);
                log(`‚úÖ Producto creado con ID: ${docRef.id}`, 'success');
                log(`<pre>${JSON.stringify(testProduct, null, 2)}</pre>`, 'success');
                log('üëâ Ahora recarga el panel admin para verlo', 'success');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        });

        // Auto-ejecutar test de conexi√≥n
        setTimeout(() => {
            document.getElementById('testConnection').click();
        }, 500);
    </script>
</body>
</html>